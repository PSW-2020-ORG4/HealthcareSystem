version: "3.8"
services: 
  database:
    image: mysql:8.0.22
    environment:
      MYSQL_ROOT_PASSWORD: "password"
      MYSQL_USER: "org4"
      MYSQL_PASSWORD: "org4"
      MYSQL_DATABASE: "organization4db"
    networks:
      - demo
    volumes:
      - sql-scripts:/docker-entrypoint-initdb.d/

  patientwebapp:
    build:
      context: HealthcareSystem\
      dockerfile: Dockerfile.patient-webapp
    ports:
    - "8181:80"
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      DbConnectionSettings:Host: "database"
      DbConnectionSettings:Port: "5432"
      DbConnectionSettings:User: "org4"
      DbConnectionSettings:Password: "org4"
      DbConnectionSettings:Database: "organization4db"
      DbConnectionSettings:RetryCount: 100
      DbConnectionSettings:RetryWaitInSeconds: 30
    depends_on:
      - database
    restart: on-failure
    volumes:
      - sql-scripts:/app/sql
    networks:
      - demo

  intergrationadapters:
    build:
      context: HealthcareSystem\
      dockerfile: Dockerfile.integration-adapters
    ports:
    - "8282:80"
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      DbConnectionSettings:Host: "database"
      DbConnectionSettings:Port: "3306"
      DbConnectionSettings:User: "org4"
      DbConnectionSettings:Password: "org4"
      DbConnectionSettings:Database: "organization4db"
      DbConnectionSettings:RetryCount: 100
      DbConnectionSettings:RetryWaitInSeconds: 30
      RabbitMq:Hostname: "rabbitmq"
      RabbitMq:Username: "org4"
      RabbitMq:Password: "org4"
      RabbitMq:RetryCount: 20
      RabbitMq:RetryWait: 30000
    depends_on:
      - database
      - rabbitmq
    restart: on-failure
    networks:
      - demo

  editorserver:
    build:
      context: HealthcareSystem\
      dockerfile: Dockerfile.graphical-editorserver
    ports:
    - "5001:80"
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      DbConnectionSettings:Host: "database"
      DbConnectionSettings:Port: "3306"
      DbConnectionSettings:User: "org4"
      DbConnectionSettings:Password: "org4"
      DbConnectionSettings:Database: "organization4db"
      DbConnectionSettings:RetryCount: 100
      DbConnectionSettings:RetryWaitInSeconds: 30
    depends_on:
      - database
    restart: on-failure
    networks:
      - demo

  rabbitmq:
    image: rabbitmq:3-management-alpine
    environment:
      RABBITMQ_DEFAULT_USER: "org4"
      RABBITMQ_DEFAULT_PASS: "org4"
    networks:
      - demo

volumes:
  sql-scripts:

networks:
  demo:
    name: demo
    driver: bridge